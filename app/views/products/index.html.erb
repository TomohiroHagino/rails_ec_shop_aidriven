<h1 class="products__title">商品一覧</h1>

<% if @products.empty? %>
  <p class="products__empty">商品がありません</p>
<% else %>
  <div class="grid grid--3-col">
    <% @products.each do |product| %>
      <div class="product-card">
        <h3 class="product-card__title"><%= product.name %></h3>
        <p class="product-card__description"><%= truncate(product.description, length: 100) %></p>
        <p class="product-card__price">¥<%= number_with_delimiter(product.price.to_i) %></p>
        <p class="product-card__stock">在庫: <%= product.stock_quantity %></p>
        
        <div class="product-card__actions">
          <%= link_to "詳細を見る", product_path(product.id.value), class: "product-card__detail-link" %>
          
          <% if logged_in? %>
            <%= form_with url: cart_items_path, method: :post, local: true, class: "product-card__add-form" do |f| %>
              <%= f.hidden_field :product_id, value: product.id.value %>
              <%= f.hidden_field :quantity, value: 1 %>
              <%= f.submit "カートへ", class: "product-card__add-btn" %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

